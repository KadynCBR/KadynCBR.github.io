<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Danmaku | Kadyn S. Martinez</title> <meta name="author" content="Kadyn S. Martinez"/> <meta name="description" content="Unity twinstick shooter"/> <meta name="keywords" content="Software Engineer, Computer scientist, Gameplay engineer, game programmer, roboticist, robots, robotics, unity, ROS"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçí</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://kadyncbr.github.io/projects/danmaku/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Kadyn¬†</span>S.¬†Martinez</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Danmaku</h1> <p class="post-description">Unity twinstick shooter</p> </header> <article> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <div class="embed-responsive embed-responsive-16by9"> <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/txsRaaYUU8o" allowfullscreen=""></iframe> </div> </div> </div> <div class="caption"> First level video demo </div> <h2 id="summary--purpose">Summary &amp; Purpose</h2> <p>Danmaku was originally a gamejam title that I felt compelled to finish up as it was simple but also had a lot of promise in terms technical challenge. I‚Äôll discuss the key interesting things as well as provide a brief video playthrough of the level. The game should be on itch.io soon for download.</p> <p>Discussion points:</p> <ul> <li>Behavior Tree AI</li> <li>Smart pooling bullet objects</li> <li>Scriptable Object Event Architecture</li> <li>Custom Tools for map creation</li> <li>Procedurally Generated Animations</li> <li>World Transition Gimmick</li> </ul> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/dmku/im1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/dmku/im1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/dmku/im1-1400.webp"></source> <img src="/assets/img/dmku/im1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Ship Activation" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/dmku/im2-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/dmku/im2-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/dmku/im2-1400.webp"></source> <img src="/assets/img/dmku/im2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Enemies and bullets" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/dmku/im3-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/dmku/im3-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/dmku/im3-1400.webp"></source> <img src="/assets/img/dmku/im3.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Boss 1" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> On the left, our ship playable character. Middle, combat encounter with enemy ships. Right, the introduction cutscene frame for the first boss fight. </div> <hr> <h2 id="behavior-tree-ai">Behavior Tree AI</h2> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <div class="embed-responsive embed-responsive-16by9"> <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/S4-dvw6AC48" allowfullscreen=""></iframe> </div> </div> </div> <div class="caption"> The behavior tree for the first boss. </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/dmku/im6-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/dmku/im6-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/dmku/im6-1400.webp"></source> <img src="/assets/img/dmku/im6.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="PixelMage AI Tree" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> An enemy AI Tree which teleports to avoid damage after fighting </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/dmku/im7-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/dmku/im7-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/dmku/im7-1400.webp"></source> <img src="/assets/img/dmku/im7.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Action Combat AI" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> An unusued AI behavior tree designed for a more complex game I'm also doing. </div> <p>For enemy AI, I wanted more practice with working with behavior trees. The above display the behavior trees I‚Äôve created. A lot of these have simple nodes but there are also a few custom nodes that I made specifically for that enemy or that combat encounter.</p> <hr> <h2 id="smart-pooling-bullet-objects">Smart Pooling Bullet Objects</h2> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <div class="embed-responsive embed-responsive-16by9"> <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/lZm9WcnWrLE" allowfullscreen=""></iframe> </div> </div> </div> <div class="caption"> There's a lot of bullets to manage. They all pretty much manage themselves though, which is nice. I enjoy my create and forget objects. </div> <p>Since this game was intended to be a sort of bullet hell game, I wanted to manage the many bullets that were going to be on screen at the same time in an efficient manner. To this end I created a bullet manager to accomplish this.</p> <p>Anytime a bullet is required by an entity it asks this level-wide manager. The manager then checks to see if a bullet is available in the queue, if it is, it will enable it and set it up as required. If not, it will create a new bullet.</p> <p>Once a bullet has run its course or made impact, instead of destroying, it notifies the bullet manager, and places itself back into a queue ready to be used for the next time the bullet manager needs a new bullet.</p> <p>Doing this removes the constant overhead of creating and deleting bullets.</p> <hr> <h2 id="scriptable-object-event-architecture">Scriptable Object Event Architecture</h2> <p>This game was made with a strong lean into Scriptable Object Event Architecture. This <a href="https://www.youtube.com/watch?v=raQ3iHhE_Kk" target="_blank" rel="noopener noreferrer">talk</a> was pretty inspiring to try using events to decouple a lot of the systems talked about here. I found I really enjoyed working with this paradigm, despite it not having as clear a paper trail as traditional dependency injection in unity. The benefits far outweight the cons in my head as a lot of these systems I made are easily portable to other projects. I extended the methods discussed in the talk quite a bit, adding generics and parameters to events, as well as making special Scriptable Object variables to house custom data types and the like.</p> <hr> <h2 id="custom-map-creation-tools">Custom Map Creation Tools</h2> <div class="row justify-content-sm-center"> <div class="col-sm-8 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/dmku/im5-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/dmku/im5-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/dmku/im5-1400.webp"></source> <img src="/assets/img/dmku/im5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Level" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm-4 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/dmku/pixil-black-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/dmku/pixil-black-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/dmku/pixil-black-1400.webp"></source> <img src="/assets/img/dmku/pixil-black.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Pixel source" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Left, level created. Right, pixel map used to generate left. </div> <p>To make map generation easier, I implemented some map generation tooling which takes png images to create a level. The actual implementation is pretty simple with some unity editor tooling wrapped around it. We go through each pixel in the provided image, and then spaw the block or enemy at the calculated offset. This map is also automatically enrolled in the world shift gimmick discussed later.</p> <div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">CreateMap</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="n">Texture2D</span> <span class="n">map</span> <span class="k">in</span> <span class="n">maps</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">mapwidth</span> <span class="p">=</span> <span class="n">map</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">mapheight</span> <span class="p">=</span> <span class="n">map</span><span class="p">.</span><span class="n">height</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">xoffset</span> <span class="p">=</span> <span class="p">-(</span><span class="n">map</span><span class="p">.</span><span class="n">width</span><span class="p">)</span> <span class="p">/</span> <span class="m">2</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">zoffset</span> <span class="p">=</span> <span class="p">-(</span><span class="n">map</span><span class="p">.</span><span class="n">height</span><span class="p">)</span> <span class="p">/</span> <span class="m">2</span><span class="p">;</span>
        <span class="n">Color</span><span class="p">[]</span> <span class="n">pixels</span> <span class="p">=</span> <span class="n">map</span><span class="p">.</span><span class="nf">GetPixels</span><span class="p">();</span>
        <span class="kt">float</span> <span class="n">px</span><span class="p">,</span> <span class="n">pz</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">pixels</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="n">px</span> <span class="p">=</span> <span class="n">i</span> <span class="p">%</span> <span class="n">mapwidth</span> <span class="p">*</span> <span class="n">distanceBetweenCells</span> <span class="p">+</span> <span class="n">xoffset</span><span class="p">;</span>
            <span class="n">pz</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">Floor</span><span class="p">(</span><span class="n">i</span> <span class="p">/</span> <span class="n">mapwidth</span><span class="p">)</span> <span class="p">*</span> <span class="n">distanceBetweenCells</span> <span class="p">+</span> <span class="n">zoffset</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pixels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pixels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">==</span> <span class="n">Color</span><span class="p">.</span><span class="n">white</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">CreateBlock</span><span class="p">(</span><span class="n">blocktype</span><span class="p">.</span><span class="n">WHITE</span><span class="p">,</span> <span class="n">px</span><span class="p">,</span> <span class="n">pz</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pixels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">==</span> <span class="n">Color</span><span class="p">.</span><span class="n">black</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">CreateBlock</span><span class="p">(</span><span class="n">blocktype</span><span class="p">.</span><span class="n">BLACK</span><span class="p">,</span> <span class="n">px</span><span class="p">,</span> <span class="n">pz</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pixels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span> <span class="p">&gt;</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">pixels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">createEnemy</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">pz</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <hr> <h2 id="procedually-generated-animations">Procedually Generated Animations</h2> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <div class="embed-responsive embed-responsive-16by9"> <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/36ifthpvv_0" allowfullscreen=""></iframe> </div> </div> </div> <div class="caption"> To save time and allow for dynamic movement of this tripod character, I implemented inverse kinematics to procedually animate the character. This is easier done in game than in <a href="https://www.youtube.com/watch?v=xEQ1KPo9HM8" target="_blank" rel="noopener noreferrer">real life.</a> </div> <hr> <h2 id="world-transition-gimmick">World Transition Gimmick</h2> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/dmku/transition.gif-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/dmku/transition.gif-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/dmku/transition.gif-1400.webp"></source> <img src="/assets/img/dmku/transition.gif" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="World Transition" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> World transition shifts color of the player character, but also shifts the world around it, allowing different obstacles or barriers to come into play. </div> <p>This Gimmick was the whole purpose of the game initially, the theme for the gamejam was something like ‚Äúsplit decisions‚Äù. So the game is based around shifting between these worlds.</p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> ¬© Copyright 2024 Kadyn S. Martinez. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>